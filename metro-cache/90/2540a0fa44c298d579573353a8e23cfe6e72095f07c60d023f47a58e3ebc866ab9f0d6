{"dependencies":[{"name":"tiny-queue","data":{"isAsync":false}},{"name":"immediate","data":{"isAsync":false}},{"name":"noop-fn","data":{"isAsync":false}},{"name":"./WebSQLTransaction","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  var Queue = _$$_REQUIRE(_dependencyMap[0], \"tiny-queue\");\n\n  var immediate = _$$_REQUIRE(_dependencyMap[1], \"immediate\");\n\n  var noop = _$$_REQUIRE(_dependencyMap[2], \"noop-fn\");\n\n  var WebSQLTransaction = _$$_REQUIRE(_dependencyMap[3], \"./WebSQLTransaction\");\n\n  var ROLLBACK = [{\n    sql: 'ROLLBACK;',\n    args: []\n  }];\n  var COMMIT = [{\n    sql: 'END;',\n    args: []\n  }];\n\n  function TransactionTask(readOnly, txnCallback, errorCallback, successCallback) {\n    this.readOnly = readOnly;\n    this.txnCallback = txnCallback;\n    this.errorCallback = errorCallback;\n    this.successCallback = successCallback;\n  }\n\n  function WebSQLDatabase(dbVersion, db) {\n    this.version = dbVersion;\n    this._db = db;\n    this._txnQueue = new Queue();\n    this._running = false;\n    this._currentTask = null;\n  }\n\n  WebSQLDatabase.prototype._onTransactionComplete = function (err) {\n    var self = this;\n\n    function done() {\n      if (err) {\n        self._currentTask.errorCallback(err);\n      } else {\n        self._currentTask.successCallback();\n      }\n\n      self._running = false;\n      self._currentTask = null;\n\n      self._runNextTransaction();\n    }\n\n    if (self._currentTask.readOnly) {\n      done();\n    } else if (err) {\n      self._db.exec(ROLLBACK, false, done);\n    } else {\n      self._db.exec(COMMIT, false, done);\n    }\n  };\n\n  WebSQLDatabase.prototype._runTransaction = function () {\n    var self = this;\n    var txn = new WebSQLTransaction(self);\n    immediate(function () {\n      self._currentTask.txnCallback(txn);\n\n      txn._checkDone();\n    });\n  };\n\n  WebSQLDatabase.prototype._runNextTransaction = function () {\n    if (this._running) {\n      return;\n    }\n\n    var task = this._txnQueue.shift();\n\n    if (!task) {\n      return;\n    }\n\n    this._currentTask = task;\n    this._running = true;\n\n    this._runTransaction();\n  };\n\n  WebSQLDatabase.prototype._createTransaction = function (readOnly, txnCallback, errorCallback, successCallback) {\n    errorCallback = errorCallback || noop;\n    successCallback = successCallback || noop;\n\n    if (typeof txnCallback !== 'function') {\n      throw new Error('The callback provided as parameter 1 is not a function.');\n    }\n\n    this._txnQueue.push(new TransactionTask(readOnly, txnCallback, errorCallback, successCallback));\n\n    this._runNextTransaction();\n  };\n\n  WebSQLDatabase.prototype.transaction = function (txnCallback, errorCallback, successCallback) {\n    this._createTransaction(false, txnCallback, errorCallback, successCallback);\n  };\n\n  WebSQLDatabase.prototype.readTransaction = function (txnCallback, errorCallback, successCallback) {\n    this._createTransaction(true, txnCallback, errorCallback, successCallback);\n  };\n\n  module.exports = WebSQLDatabase;\n});","map":[[2,0,1,0],[4,0,3,0],[4,6,3,4,"Queue"],[4,11,3,9],[4,14,3,12,"require"],[4,25,3,19],[4,58,3,0],[6,0,4,0],[6,6,4,4,"immediate"],[6,15,4,13],[6,18,4,16,"require"],[6,29,4,23],[6,61,4,0],[8,0,5,0],[8,6,5,4,"noop"],[8,10,5,8],[8,13,5,11,"require"],[8,24,5,18],[8,54,5,0],[10,0,7,0],[10,6,7,4,"WebSQLTransaction"],[10,23,7,21],[10,26,7,24,"require"],[10,37,7,31],[10,79,7,0],[12,0,9,0],[12,6,9,4,"ROLLBACK"],[12,14,9,12],[12,17,9,15],[12,18,10,2],[13,0,10,3,"sql"],[13,4,10,3,"sql"],[13,7,10,6],[13,9,10,8],[13,20,10,2],[14,0,10,21,"args"],[14,4,10,21,"args"],[14,8,10,25],[14,10,10,27],[15,0,10,2],[15,3,9,15],[15,4,9,0],[16,0,13,0],[16,6,13,4,"COMMIT"],[16,12,13,10],[16,15,13,13],[16,16,14,2],[17,0,14,3,"sql"],[17,4,14,3,"sql"],[17,7,14,6],[17,9,14,8],[17,15,14,2],[18,0,14,16,"args"],[18,4,14,16,"args"],[18,8,14,20],[18,10,14,22],[19,0,14,2],[19,3,13,13],[19,4,13,0],[21,0,18,0],[21,11,18,9,"TransactionTask"],[21,26,18,0],[21,27,18,25,"readOnly"],[21,35,18,0],[21,37,18,35,"txnCallback"],[21,48,18,0],[21,50,18,48,"errorCallback"],[21,63,18,0],[21,65,18,63,"successCallback"],[21,80,18,0],[21,82,18,80],[22,0,19,2],[22,9,19,7,"readOnly"],[22,17,19,2],[22,20,19,18,"readOnly"],[22,28,19,2],[23,0,20,2],[23,9,20,7,"txnCallback"],[23,20,20,2],[23,23,20,21,"txnCallback"],[23,34,20,2],[24,0,21,2],[24,9,21,7,"errorCallback"],[24,22,21,2],[24,25,21,23,"errorCallback"],[24,38,21,2],[25,0,22,2],[25,9,22,7,"successCallback"],[25,24,22,2],[25,27,22,25,"successCallback"],[25,42,22,2],[26,0,23,1],[28,0,25,0],[28,11,25,9,"WebSQLDatabase"],[28,25,25,0],[28,26,25,24,"dbVersion"],[28,35,25,0],[28,37,25,35,"db"],[28,39,25,0],[28,41,25,39],[29,0,26,2],[29,9,26,7,"version"],[29,16,26,2],[29,19,26,17,"dbVersion"],[29,28,26,2],[30,0,27,2],[30,9,27,7,"_db"],[30,12,27,2],[30,15,27,13,"db"],[30,17,27,2],[31,0,28,2],[31,9,28,7,"_txnQueue"],[31,18,28,2],[31,21,28,19],[31,25,28,23,"Queue"],[31,30,28,19],[31,32,28,2],[32,0,29,2],[32,9,29,7,"_running"],[32,17,29,2],[32,20,29,18],[32,25,29,2],[33,0,30,2],[33,9,30,7,"_currentTask"],[33,21,30,2],[33,24,30,22],[33,28,30,2],[34,0,31,1],[36,0,33,0,"WebSQLDatabase"],[36,2,33,0,"WebSQLDatabase"],[36,16,33,14],[36,17,33,15,"prototype"],[36,26,33,0],[36,27,33,25,"_onTransactionComplete"],[36,49,33,0],[36,52,33,50],[36,62,33,59,"err"],[36,65,33,50],[36,67,33,64],[37,0,34,2],[37,8,34,6,"self"],[37,12,34,10],[37,15,34,13],[37,19,34,2],[39,0,36,2],[39,13,36,11,"done"],[39,17,36,2],[39,20,36,18],[40,0,37,4],[40,10,37,8,"err"],[40,13,37,4],[40,15,37,13],[41,0,38,6,"self"],[41,8,38,6,"self"],[41,12,38,10],[41,13,38,11,"_currentTask"],[41,25,38,6],[41,26,38,24,"errorCallback"],[41,39,38,6],[41,40,38,38,"err"],[41,43,38,6],[42,0,39,5],[42,7,37,4],[42,13,39,11],[43,0,40,6,"self"],[43,8,40,6,"self"],[43,12,40,10],[43,13,40,11,"_currentTask"],[43,25,40,6],[43,26,40,24,"successCallback"],[43,41,40,6],[44,0,41,5],[46,0,42,4,"self"],[46,6,42,4,"self"],[46,10,42,8],[46,11,42,9,"_running"],[46,19,42,4],[46,22,42,20],[46,27,42,4],[47,0,43,4,"self"],[47,6,43,4,"self"],[47,10,43,8],[47,11,43,9,"_currentTask"],[47,23,43,4],[47,26,43,24],[47,30,43,4],[49,0,44,4,"self"],[49,6,44,4,"self"],[49,10,44,8],[49,11,44,9,"_runNextTransaction"],[49,30,44,4],[50,0,45,3],[52,0,47,2],[52,8,47,6,"self"],[52,12,47,10],[52,13,47,11,"_currentTask"],[52,25,47,6],[52,26,47,24,"readOnly"],[52,34,47,2],[52,36,47,34],[53,0,48,4,"done"],[53,6,48,4,"done"],[53,10,48,8],[54,0,49,3],[54,5,47,2],[54,11,49,9],[54,15,49,13,"err"],[54,18,49,9],[54,20,49,18],[55,0,50,4,"self"],[55,6,50,4,"self"],[55,10,50,8],[55,11,50,9,"_db"],[55,14,50,4],[55,15,50,13,"exec"],[55,19,50,4],[55,20,50,18,"ROLLBACK"],[55,28,50,4],[55,30,50,28],[55,35,50,4],[55,37,50,35,"done"],[55,41,50,4],[56,0,51,3],[56,5,49,9],[56,11,51,9],[57,0,52,4,"self"],[57,6,52,4,"self"],[57,10,52,8],[57,11,52,9,"_db"],[57,14,52,4],[57,15,52,13,"exec"],[57,19,52,4],[57,20,52,18,"COMMIT"],[57,26,52,4],[57,28,52,26],[57,33,52,4],[57,35,52,33,"done"],[57,39,52,4],[58,0,53,3],[59,0,54,1],[59,3,33,0],[61,0,56,0,"WebSQLDatabase"],[61,2,56,0,"WebSQLDatabase"],[61,16,56,14],[61,17,56,15,"prototype"],[61,26,56,0],[61,27,56,25,"_runTransaction"],[61,42,56,0],[61,45,56,43],[61,57,56,55],[62,0,57,2],[62,8,57,6,"self"],[62,12,57,10],[62,15,57,13],[62,19,57,2],[63,0,58,2],[63,8,58,6,"txn"],[63,11,58,9],[63,14,58,12],[63,18,58,16,"WebSQLTransaction"],[63,35,58,12],[63,36,58,34,"self"],[63,40,58,12],[63,41,58,2],[64,0,60,2,"immediate"],[64,4,60,2,"immediate"],[64,13,60,11],[64,14,60,12],[64,26,60,24],[65,0,61,4,"self"],[65,6,61,4,"self"],[65,10,61,8],[65,11,61,9,"_currentTask"],[65,23,61,4],[65,24,61,22,"txnCallback"],[65,35,61,4],[65,36,61,34,"txn"],[65,39,61,4],[67,0,62,4,"txn"],[67,6,62,4,"txn"],[67,9,62,7],[67,10,62,8,"_checkDone"],[67,20,62,4],[68,0,63,3],[68,5,60,11],[68,6,60,2],[69,0,64,1],[69,3,56,0],[71,0,66,0,"WebSQLDatabase"],[71,2,66,0,"WebSQLDatabase"],[71,16,66,14],[71,17,66,15,"prototype"],[71,26,66,0],[71,27,66,25,"_runNextTransaction"],[71,46,66,0],[71,49,66,47],[71,61,66,58],[72,0,67,2],[72,8,67,6],[72,13,67,11,"_running"],[72,21,67,2],[72,23,67,21],[73,0,68,4],[74,0,69,3],[76,0,70,2],[76,8,70,6,"task"],[76,12,70,10],[76,15,70,13],[76,20,70,18,"_txnQueue"],[76,29,70,13],[76,30,70,28,"shift"],[76,35,70,13],[76,37,70,2],[78,0,72,2],[78,8,72,6],[78,9,72,7,"task"],[78,13,72,2],[78,15,72,13],[79,0,73,4],[80,0,74,3],[82,0,76,2],[82,9,76,7,"_currentTask"],[82,21,76,2],[82,24,76,22,"task"],[82,28,76,2],[83,0,77,2],[83,9,77,7,"_running"],[83,17,77,2],[83,20,77,18],[83,24,77,2],[85,0,78,2],[85,9,78,7,"_runTransaction"],[85,24,78,2],[86,0,79,1],[86,3,66,0],[88,0,81,0,"WebSQLDatabase"],[88,2,81,0,"WebSQLDatabase"],[88,16,81,14],[88,17,81,15,"prototype"],[88,26,81,0],[88,27,81,25,"_createTransaction"],[88,45,81,0],[88,48,81,46],[88,58,82,4,"readOnly"],[88,66,81,46],[88,68,82,14,"txnCallback"],[88,79,81,46],[88,81,82,27,"errorCallback"],[88,94,81,46],[88,96,82,42,"successCallback"],[88,111,81,46],[88,113,82,59],[89,0,83,2,"errorCallback"],[89,4,83,2,"errorCallback"],[89,17,83,15],[89,20,83,18,"errorCallback"],[89,33,83,31],[89,37,83,35,"noop"],[89,41,83,2],[90,0,84,2,"successCallback"],[90,4,84,2,"successCallback"],[90,19,84,17],[90,22,84,20,"successCallback"],[90,37,84,35],[90,41,84,39,"noop"],[90,45,84,2],[92,0,86,2],[92,8,86,6],[92,15,86,13,"txnCallback"],[92,26,86,6],[92,31,86,29],[92,41,86,2],[92,43,86,41],[93,0,87,4],[93,12,87,10],[93,16,87,14,"Error"],[93,21,87,10],[93,22,87,20],[93,79,87,10],[93,80,87,4],[94,0,88,3],[96,0,90,2],[96,9,90,7,"_txnQueue"],[96,18,90,2],[96,19,90,17,"push"],[96,23,90,2],[96,24,90,22],[96,28,90,26,"TransactionTask"],[96,43,90,22],[96,44,90,42,"readOnly"],[96,52,90,22],[96,54,90,52,"txnCallback"],[96,65,90,22],[96,67,90,65,"errorCallback"],[96,80,90,22],[96,82,90,80,"successCallback"],[96,97,90,22],[96,98,90,2],[98,0,91,2],[98,9,91,7,"_runNextTransaction"],[98,28,91,2],[99,0,92,1],[99,3,81,0],[101,0,94,0,"WebSQLDatabase"],[101,2,94,0,"WebSQLDatabase"],[101,16,94,14],[101,17,94,15,"prototype"],[101,26,94,0],[101,27,94,25,"transaction"],[101,38,94,0],[101,41,94,39],[101,51,94,49,"txnCallback"],[101,62,94,39],[101,64,94,62,"errorCallback"],[101,77,94,39],[101,79,94,77,"successCallback"],[101,94,94,39],[101,96,94,94],[102,0,95,2],[102,9,95,7,"_createTransaction"],[102,27,95,2],[102,28,95,26],[102,33,95,2],[102,35,95,33,"txnCallback"],[102,46,95,2],[102,48,95,46,"errorCallback"],[102,61,95,2],[102,63,95,61,"successCallback"],[102,78,95,2],[103,0,96,1],[103,3,94,0],[105,0,98,0,"WebSQLDatabase"],[105,2,98,0,"WebSQLDatabase"],[105,16,98,14],[105,17,98,15,"prototype"],[105,26,98,0],[105,27,98,25,"readTransaction"],[105,42,98,0],[105,45,98,43],[105,55,98,53,"txnCallback"],[105,66,98,43],[105,68,98,66,"errorCallback"],[105,81,98,43],[105,83,98,81,"successCallback"],[105,98,98,43],[105,100,98,98],[106,0,99,2],[106,9,99,7,"_createTransaction"],[106,27,99,2],[106,28,99,26],[106,32,99,2],[106,34,99,32,"txnCallback"],[106,45,99,2],[106,47,99,45,"errorCallback"],[106,60,99,2],[106,62,99,60,"successCallback"],[106,77,99,2],[107,0,100,1],[107,3,98,0],[109,0,102,0,"module"],[109,2,102,0,"module"],[109,8,102,6],[109,9,102,7,"exports"],[109,16,102,0],[109,19,102,17,"WebSQLDatabase"],[109,33,102,0]]},"type":"js/module"}]}